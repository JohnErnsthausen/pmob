<script type="text/javascript">
  function setText(id, text) {
    var topicHeader = document.getElementById(id)
    if (topicHeader)
      topicHeader.innerHTML = text
    else
      console.log('id not found: ', id)
  }

  function element(id) {
    return document.getElementById(id)
  }

  function getText(id) {
    return document.getElementById(id).innerHTML
  }

  function renderIf(element, condition) {
    element.style.display = condition ? '' : 'none'
  }

  function renderPost(id, offeringTechs, offeringTopics, topicFilterSelection, techFilterSelection) {
    var element = document.getElementById(id)
    if (element) {
      var shouldRender = (topicFilterSelection === '' && techFilterSelection === '') ||
        (topicFilterSelection === '' && offeringTechs.includes(techFilterSelection)) ||
        (offeringTopics.includes(topicFilterSelection) && techFilterSelection == '') ||
        (offeringTopics.includes(topicFilterSelection) && offeringTechs.includes(techFilterSelection));
      renderIf(element, shouldRender);
    }
  }

  function renderPosts(topicFilterSelection, techFilterSelection) {
    {% for offering in site.offerings %}
      renderPost("{{ offering.id }}",
        {{ offering.languages | jsonify }}, 
        {{ offering.topics | jsonify }},
        topicFilterSelection, 
        techFilterSelection);
    {% endfor %}
  }

  function rerenderPosts() {
    renderPosts(getText('selectedTopic'), getText('selectedTech'))
  }

  function clearFilterSelection(displayElementId, spanId) {
    setText(displayElementId, '')
    renderIf(element(spanId), false)
    rerenderPosts()
  }

  function filter(displayElementId, spanId, filterSelection) {
    setText(displayElementId, filterSelection)
    renderIf(element(spanId), true)
    rerenderPosts()
  }
</script>

<section class="class-legend">
  <article class="filters">
    {% include filters.html %}
  </article>
  <article class="key">
    {% include skills-key.html %}
  </article>
  <article class="activeFilters">
    <span>Filters: <i class="fa fa-close" aria-hidden="true"></i>
      <span id="selectedTopicFilter" style="display:none">
        <button class="filterButton" onClick="clearFilterSelection('selectedTopic', 'selectedTopicFilter')"><span id="selectedTopic"></span> &times;</button>
      </span>
      <span id="selectedTechFilter" style="display:none">
        <button class="filterButton" onClick="clearFilterSelection('selectedTech', 'selectedTechFilter')"><span id="selectedTech"></span> &times;</button>
      </span>
    </span>
  </article>
</section>
