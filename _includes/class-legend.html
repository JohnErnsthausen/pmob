<script type="text/javascript">
  function setText(id, text) {
    var topicHeader = document.getElementById(id)
    if (topicHeader)
      topicHeader.innerHTML = text
    else
      console.log('id not found: ', id)
  }

  function element(id) {
    return document.getElementById(id)
  }

  function getText(id) {
    return document.getElementById(id).innerHTML
  }

  function renderIf(element, condition) {
    element.style.display = condition ? '' : 'none'
  }

  function renderPost(id, offeringTechs, offeringTopics, topicFilterSelection, techFilterSelection) {
    var element = document.getElementById(id);
    if (element) {
      var shouldRender = (topicFilterSelection === '' && techFilterSelection === '') ||
        (topicFilterSelection === '' && offeringTechs.includes(techFilterSelection)) ||
        (offeringTopics.includes(topicFilterSelection) && techFilterSelection == '') ||
        (offeringTopics.includes(topicFilterSelection) && offeringTechs.includes(techFilterSelection));
      renderIf(element, shouldRender);
    }
  }

  function renderPosts(topicFilterSelection, techFilterSelection) {
    {% for offering in site.offerings %}
      renderPost("{{ offering.id }}",
        {{ offering.languages | jsonify }}, 
        {{ offering.topics | jsonify }},
        topicFilterSelection, 
        techFilterSelection);
    {% endfor %}
  }

  function clearFilterSelections(elementIds) {
    for (let i = 0; i < elementIds.length; i++)
      setText(elementIds[i], '');
    renderPosts('', '');
    renderIf(element('selectedTechFilter'), false)
    renderIf(element('selectedTopicFilter'), false)
    renderIf(element('clearFiltersButton'), false)
  }

  function filterUsingTopic(displayElementId, filterSelection, existingTechElementId) {
    setText(displayElementId, filterSelection)
    renderIf(element('selectedTechFilter'), true)
    renderIf(element('selectedTopicFilter'), true)
    renderIf(element('clearFiltersButton'), true)
    var existingTechFilter = getText(existingTechElementId)
    renderPosts(filterSelection, existingTechFilter)
  }

  function filterUsingTech(displayElementId, filterSelection, existingTopicElementId) {
    setText(displayElementId, filterSelection)
    var existingTopicFilter = getText(existingTopicElementId)
    renderPosts(existingTopicFilter, filterSelection)
    renderIf(element('clearFiltersButton'), true)
  }
</script>

<section class="class-legend">
  <article class="filters">
    {% include filters.html %}
  </article>
  <article class="key">
    {% include skills-key.html %}
  </article>
  <article class="activeFilters">
    <button id="clearFiltersButton" 
      style="display:none"
      onclick="clearFilterSelections(['selectedTopic', 'selectedTech'])">
      Clear
    </button>
    <span>Filters: 
      <span id="selectedTopicFilter" style="display:none"><span id="selectedTopic" /></span>
      <span id="selectedTechFilter" style="display:none"><span id="selectedTech" /></span>
    </span>
  </article>
</section>
