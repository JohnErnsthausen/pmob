<script type="text/javascript">
  function setText(id, text) {
    var elt = document.getElementById(id)
    if (elt)
      elt.innerHTML = text
    else
      console.log('cannot setText; id not found: ', id)
  }

  function setButtonText(id, text) {
    var button = document.getElementById(id)
    if (button)
      button.textContent = text
    else
      console.log('cannot setButtonText; id not found: ', id)
  }

  function element(id) {
    var elt = document.getElementById(id)
    if (!elt)
      console.log('id not found: ', id)
    return elt
  }

  function getText(id) {
    var elt = document.getElementById(id)
    if (elt)
      return elt.innerHTML
    console.log( 'id not found: ' + id)

  }

  function renderIf(elt, condition) {
    elt.style.display = condition ? '' : 'none'
  }

  
  function showElementWithId(id) {
    renderIf(element(id), true)
  }

  function renderPost(id, offeringTechs, offeringTopics, topicFilterSelection, techFilterSelection) {
    var elt = document.getElementById(id)
    if (elt) {
      var shouldRender = (topicFilterSelection === '' && techFilterSelection === '') ||
        (topicFilterSelection === '' && offeringTechs.includes(techFilterSelection)) ||
        (offeringTopics.includes(topicFilterSelection) && techFilterSelection == '') ||
        (offeringTopics.includes(topicFilterSelection) && offeringTechs.includes(techFilterSelection));
      renderIf(elt, shouldRender);
    }
  }

  function renderPosts(topicFilterSelection, techFilterSelection) {
    {% for offering in site.offerings %}
      renderPost("{{ offering.id }}",
        {{ offering.languages | jsonify }}, 
        {{ offering.topics | jsonify }},
        topicFilterSelection, 
        techFilterSelection);
    {% endfor %}
  }

  function rerenderPosts() {
    renderPosts(getText('selectedTopic'), getText('selectedTech'))
  }

  function clearFilterSelection(filterSelectionElementId, buttonId) {
    setText(filterSelectionElementId, '')
    renderIf(element(buttonId), false)
    rerenderPosts()
  }

  const xGlyph = '\u00D7'

  function filterTopic(filterSelectionElementId, filterSelectionButtonId, filterSelectionButtonText, filterSelection) {
    setText(filterSelectionElementId, filterSelection)
    setButtonText('selectedTopicButton', filterSelectionButtonText + ' ' + xGlyph);
    showElementWithId(filterSelectionButtonId)
    rerenderPosts()
  }

  function filterTech(filterSelectionElementId, filterSelectionButtonId, filterSelectionButtonText, filterSelection) {
    setText(filterSelectionElementId, filterSelection)
    setButtonText('selectedTechButton', filterSelectionButtonText + ' ' + xGlyph);
    showElementWithId(filterSelectionButtonId)
    rerenderPosts()
  }
</script>

<section class="class-legend">
  <article class="filters">
    {% include filters.html %}
  </article>
  <article class="key">
    {% include skills-key.html %}
  </article>
  <article class="activeFilters">
    <span>Filters:
      <span id="selectedTopic" hidden></span>
      <span id="selectedTech" hidden></span>
      <button class="filterButton" id="selectedTopicButton" onClick="clearFilterSelection('selectedTopic', this.id)" style="display:none" />
      <button class="filterButton" id="selectedTechButton" onClick="clearFilterSelection('selectedTech', this.id)" style="display:none" />
    </span>
  </article>
</section>
